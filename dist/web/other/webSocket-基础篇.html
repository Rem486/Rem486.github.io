<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>webSocket-基础篇 | 从零开始的Rem486</title>
  <meta name="description" content="Rem486的博客">
  <link rel="icon" href="/img/logo.ico">
  <meta property="article:modified_time" content="2019-12-05T13:22:02.000Z"><meta property="og:site_name" content="从零开始的Rem486"><meta property="og:title" content="webSocket-基础篇"><meta property="og:type" content="website"><meta property="og:url" content="/web/other/webSocket-%E5%9F%BA%E7%A1%80%E7%AF%87.html"><meta name="twitter:title" content="webSocket-基础篇"><meta name="twitter:url" content="/web/other/webSocket-%E5%9F%BA%E7%A1%80%E7%AF%87.html"><meta name="twitter:card" content="summary_large_image">
  <link rel="preload" href="/assets/css/0.styles.e1b3f17d.css" as="style"><link rel="preload" href="/assets/js/app.936db6fe.js" as="script"><link rel="preload" href="/assets/js/2.7ada23cf.js" as="script"><link rel="preload" href="/assets/js/24.8ff20f4f.js" as="script"><link rel="prefetch" href="/assets/js/10.ce30a3b6.js"><link rel="prefetch" href="/assets/js/11.943d0a84.js"><link rel="prefetch" href="/assets/js/12.0ad4835e.js"><link rel="prefetch" href="/assets/js/13.998ed1b5.js"><link rel="prefetch" href="/assets/js/14.b990c52a.js"><link rel="prefetch" href="/assets/js/15.a2417acb.js"><link rel="prefetch" href="/assets/js/16.e309cb06.js"><link rel="prefetch" href="/assets/js/17.19869108.js"><link rel="prefetch" href="/assets/js/18.f389da6a.js"><link rel="prefetch" href="/assets/js/19.7302a1dc.js"><link rel="prefetch" href="/assets/js/20.76755589.js"><link rel="prefetch" href="/assets/js/21.d49a7cf0.js"><link rel="prefetch" href="/assets/js/22.c8616af6.js"><link rel="prefetch" href="/assets/js/23.f528c30b.js"><link rel="prefetch" href="/assets/js/25.aa14288d.js"><link rel="prefetch" href="/assets/js/26.4c2429fd.js"><link rel="prefetch" href="/assets/js/27.f2b6226a.js"><link rel="prefetch" href="/assets/js/28.e8586f4c.js"><link rel="prefetch" href="/assets/js/29.38375408.js"><link rel="prefetch" href="/assets/js/3.52985ee6.js"><link rel="prefetch" href="/assets/js/30.cd8b1a06.js"><link rel="prefetch" href="/assets/js/31.8fe337dc.js"><link rel="prefetch" href="/assets/js/32.c329345f.js"><link rel="prefetch" href="/assets/js/33.908adff4.js"><link rel="prefetch" href="/assets/js/34.1fc41086.js"><link rel="prefetch" href="/assets/js/35.7efeeb34.js"><link rel="prefetch" href="/assets/js/36.a6cfd988.js"><link rel="prefetch" href="/assets/js/37.c1a8a950.js"><link rel="prefetch" href="/assets/js/38.206a184f.js"><link rel="prefetch" href="/assets/js/39.e1f149de.js"><link rel="prefetch" href="/assets/js/4.e8819c6a.js"><link rel="prefetch" href="/assets/js/40.a44e150d.js"><link rel="prefetch" href="/assets/js/41.6d2aa337.js"><link rel="prefetch" href="/assets/js/42.38ce6979.js"><link rel="prefetch" href="/assets/js/43.9887a41c.js"><link rel="prefetch" href="/assets/js/44.4788228c.js"><link rel="prefetch" href="/assets/js/45.f32a9e9c.js"><link rel="prefetch" href="/assets/js/46.be0c7b84.js"><link rel="prefetch" href="/assets/js/47.f6f06726.js"><link rel="prefetch" href="/assets/js/48.acb6483a.js"><link rel="prefetch" href="/assets/js/49.da9a05c2.js"><link rel="prefetch" href="/assets/js/5.1519ed17.js"><link rel="prefetch" href="/assets/js/50.cacdbd33.js"><link rel="prefetch" href="/assets/js/6.5cf079fd.js"><link rel="prefetch" href="/assets/js/7.5446e295.js"><link rel="prefetch" href="/assets/js/8.af5e9e7b.js"><link rel="prefetch" href="/assets/js/9.54e91b73.js">
  <link rel="stylesheet" href="/assets/css/0.styles.e1b3f17d.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">从零开始的Rem486</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  前端笔记
</a></div><div class="nav-item"><a href="https://github.com/Rem486/Rem486.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  前端笔记
</a></div><div class="nav-item"><a href="https://github.com/Rem486/Rem486.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web/" class="sidebar-link">前端笔记</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/css/禁用移动端安卓点击图片预览.html" class="sidebar-link">禁用安卓点击图片预览</a></li><li><a href="/web/css/图片自适应宽高.html" class="sidebar-link">图片自适应宽高</a></li><li><a href="/web/css/inline-block使用overflow对齐问题.html" class="sidebar-link">inline-block使用overflow:hidden对齐问题</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/js/面向对象编程.html" class="sidebar-link">面向对象编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/mobile/滚动穿透.html" class="sidebar-link">滚动穿透</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/tool/git-配置修改远程仓库地址.html" class="sidebar-link">git-配置修改远程仓库地址</a></li><li><a href="/web/tool/git-删除远程分支.html" class="sidebar-link">git-删除远程分支</a></li><li><a href="/web/tool/http-TIME_WAIT，CLOSE_WAIT异常.html" class="sidebar-link">http-TIMEWAIT，CLOSEWAIT异常</a></li><li><a href="/web/tool/ssh-免密登录服务器及设置多个key.html" class="sidebar-link">ssh-免密登录服务器及设置多个key</a></li><li><a href="/web/tool/npm-常用操作技巧.html" class="sidebar-link">npm-常用操作技巧</a></li><li><a href="/web/tool/npm-管理项目版本号.html" class="sidebar-link">npm-管理项目版本号</a></li><li><a href="/web/tool/正则-入门.html" class="sidebar-link">正则-入门</a></li><li><a href="/web/tool/md-Markdown基本语法.html" class="sidebar-link">md-Markdown基本语法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/数据库/mongodb-常见错误.html" class="sidebar-link">mongodb-常见错误</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>杂项</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/other/文档收藏.html" class="sidebar-link">文档收藏</a></li><li><a href="/web/other/node-爬虫初体验.html" class="sidebar-link">node-爬虫初体验</a></li><li><a href="/web/other/idea-注册码持续更新.html" class="sidebar-link">idea-注册码持续更新</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="websocket-基础篇"><a href="#websocket-基础篇" class="header-anchor">#</a> webSocket-基础篇</h1> <p>创建时间：2019-12-04</p> <h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>我们都知道，现在web应用的信息交互过程，就是客户端通过浏览器发出一个请求，然后服务器端在接受和审核请求后,进行处理并将结果返回给客户端，最后由客户端的浏览器将信息呈现出来。</p> <p>随着web页面的体验的升级，出现了越来越多的对实时行要求高，海量数据并发的应用。在这些应用里面通过客户端不停发送请求的通信机制就显得捉襟见肘了。比如，网页游戏，运行监控，证券交易网站，实时聊天对话。</p> <p>为了满足这些场景，出现了各种方案，主要有这几个：</p> <ol><li>短轮询（Polling）</li> <li>长轮询（Long-Polling）</li> <li>流技术（iframe）</li></ol> <h3 id="短轮询（polling）"><a href="#短轮询（polling）" class="header-anchor">#</a> 短轮询（Polling）</h3> <p>HTTP 协议有一个缺陷：通信只能由客户端发起。
举例来说，我们想了解今天的天气，只能客户端向服务器发出请求，服务器返回查询结果。HTTP 协议做不到服务器主动向客户端推送信息。这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。</p> <p>针对这个特点，短轮询就是：客户端和服务器之间一直进行连接，每隔一段时间就询问一次。</p> <p>优点：
服务端无需做调整，在收到请求之后，不论是否有数据更新，都直接进行响应。在服务端响应完成，就会关闭这个 TCP 连接。
客户进行简单调整 setInterval 循环不停的进行请求即可。</p> <p>缺点：
因为是间隔请求，肯定有一小段时间内数据是不同步的。
会有大量无效的请求</p> <h3 id="长轮询（long-polling）"><a href="#长轮询（long-polling）" class="header-anchor">#</a> 长轮询（Long-Polling）</h3> <p>长轮询是对普通轮序的改进和提高。短轮询，每隔一段时间就请求一次，而服务端的数据可能并没有更新，造成的很多大量浪费。</p> <p>为了减少无效的网络传输，当服务器端没有数据更新时，链接会保持一段时间，直到数据或状态发生改变或连接时间过期，通过这种机制我们就可以减少很多无效的客户端和服务器间的交互。当然，如果服务器端的数据变更非常频繁的话，这种机制并没有有效的提高性能，和普通轮询没有太大的区别，且长轮询也会耗费更多的资源，比如CPU,内存,带宽等。</p> <p>优点：
对短轮询做了优化，有较好的时效性。</p> <p>缺点：
保持连接会消耗资源;
服务器没有返回有效数据，程序超时。</p> <h3 id="流技术（iframe）"><a href="#流技术（iframe）" class="header-anchor">#</a> 流技术（iframe）</h3> <p>iframe流方式是在页面中插入一个隐藏的iframe，利用其src属性在服务器和客户端之间创建一条长连接，服务器向iframe传输数据（通常是HTML，内有负责插入信息的javascript），来实时更新页面。</p> <p>通过这种机制就可以将服务器端的信息不断传向客户端，从而保证信息的时效性。</p> <p>优点：
消息能够实时到达。</p> <p>缺点：
服务器，源源不断向客户端发送数据，维护一个长连接会增加开销;
IE、chrome、Firefox会显示加载没有完成，图标会不停旋转。</p> <h3 id="什么是websocket"><a href="#什么是websocket" class="header-anchor">#</a> 什么是WebSocket</h3> <p>WebSocket 协议在2008年诞生，2011年成为国际标准。所有浏览器都已经支持了。</p> <p>WebSocket是一种全新的协议，它将TCP的Socket（套接字）应用在了webpage上，从而使通信双方建立起一个保持在活动状态连接通道。
它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种。
由于是建立在HTTP基础上的协议，因此连接的发起方仍是客户端，而一旦确立WebSocket通信连接，不论服务器还是客户端，任意一方都可直接向对方发送报文。
还具有以下特点：</p> <p>（1）建立在 TCP 协议之上，服务器端的实现比较容易。
（2）与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。
（3）数据格式比较轻量，性能开销小，通信高效。
（4）可以发送文本，也可以发送二进制数据。
（5）没有同源限制，客户端可以与任意服务器通信。
（6）协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。</p> <h3 id="心跳保活"><a href="#心跳保活" class="header-anchor">#</a> 心跳保活</h3> <p>在实际使用 WebSocket 中，长时间不通消息可能会出现一些连接不稳定的情况，这些未知情况导致的连接中断会影响客户端与服务端之前的通信。</p> <p>为了防止这种的情况的出现，有一种心跳保活的方法：客户端就像心跳一样每隔固定的时间发送一次 ping ，来告诉服务器，我还活着，而服务器也会返回 pong ，来告诉客户端，服务器还活着。ping/pong 其实是一条与业务无关的假消息，也称为心跳包。</p> <p>可以在连接成功之后，每隔一个固定时间发送心跳包，比如 60s:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> 
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'这是一条心跳包消息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>长连接：一个连接上可以连续发送多个数据包，在连接期间，如果没有数据包发送，需要双方发链路检查包。</p> <p>TCP/IP：TCP/IP属于传输层，主要解决数据在网络中的传输问题，只管传输数据。但是那样对传输的数据没有一个规范的封装、解析等处理，使得传输的数据就很难识别，所以才有了应用层协议对数据的封装、解析等，如HTTP协议。</p> <p>HTTP：HTTP是应用层协议，封装解析传输的数据。
从HTTP1.1开始其实就默认开启了长连接，也就是请求header中看到的Connection:Keep-alive。但是这个长连接只是说保持了（服务器可以告诉客户端保持时间Keep-Alive:timeout=200;max=20;）这个TCP通道，直接Request - Response，而不需要再创建一个连接通道，做到了一个性能优化。但是HTTP通讯本身还是Request - Response。</p> <p>socket：与HTTP不一样，socket不是协议，它是在程序层面上对传输层协议（可以主要理解为TCP/IP）的接口封装。
我们知道传输层的协议，是解决数据在网络中传输的，那么socket就是传输通道两端的接口。所以对于前端而言，socket也可以简单的理解为对TCP/IP的抽象协议。</p> <p>WebSocket：
WebSocket是包装成了一个应用层协议作为socket,从而能够让客户端和远程服务端通过web建立全双工通信。websocket提供ws和wss两种URL方案。协议英文文档和中文翻译</p> <p>事件
//创建WebSocket实例，可以使用ws和wss。第二个参数可以选填自定义协议，如果多协议，可以以数组方式
var socket = new WebSocket('ws://demos.kaazing.com/echo');</p> <p>轮询：客户端定时向服务器发送Ajax请求，服务器接到请求后马上返回响应信息并关闭连接。优点：后端程序编写比较容易。缺点：请求中有大半是无用，浪费带宽和服务器资源。实例：适于小型应用。</p> <p>长轮询：客户端向服务器发送Ajax请求，服务器接到请求后hold住连接，直到有新消息才返回响应信息并关闭连接，客户端处理完响应信息后再向服务器发送新的请求。优点：在无消息的情况下不会频繁的请求。缺点：服务器hold连接会消耗资源。实例：WebQQ、Hi网页版、Facebook IM。另外，对于长连接和socket连接也有区分：</p> <p>长连接：在页面里嵌入一个隐蔵iframe，将这个隐蔵iframe的src属性设为对一个长连接的请求，服务器端就能源源不断地往客户端输入数据。优点：消息即时到达，不发无用请求。缺点：服务器维护一个长连接会增加开销。实例：Gmail聊天Flash</p> <p>Socket：在页面中内嵌入一个使用了Socket类的 Flash 程序JavaScript通过调用此Flash程序提供的Socket接口与服务器端的Socket接口进行通信，JavaScript在收到服务器端传送的信息后控制页面的显示。优点：实现真正的即时通信，而不是伪即时。缺点：客户端必须安装Flash插件；非HTTP协议，无法自动穿越防火墙。实例：网络互动游戏。</p> <h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <ul><li><a href="https://juejin.im/post/5a1bdf676fb9a045055dd99d" target="_blank" rel="noopener noreferrer">WebSocket探秘<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">12/5/2019, 9:22:02 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
<script src="/assets/js/app.936db6fe.js" defer></script><script src="/assets/js/2.7ada23cf.js" defer></script><script src="/assets/js/24.8ff20f4f.js" defer></script>
</body>
<script type="text/javascript" async src="https://s5.cnzz.com/z_stat.php?id=1275911745&web_id=1275911745&show=none"></script>
</html>
