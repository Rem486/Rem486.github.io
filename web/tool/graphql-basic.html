<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>graphql - 入门 | 从零开始的故事</title>
  <meta name="description" content="">
  <meta name="keywords" content="前端博客,前端知识,前端备忘录,程序员笔记,css,html,javascript,git,linux">
  <meta name="baidu-site-verification" content="utzmmiwMvm"/>
  <link rel="icon" href="/img/logo.ico">
  <meta name="description" content="graphql基础知识">
    <meta property="article:published_time" content="2021-01-27T00:00:00.000Z">
    <meta property="og:site_name" content="从零开始的故事">
    <meta property="og:title" content="graphql - 入门">
    <meta property="og:description" content="graphql基础知识">
    <meta property="og:type" content="website">
    <meta property="og:url" content="/web/tool/graphql-basic.html">
    <meta name="twitter:title" content="graphql - 入门">
    <meta name="twitter:description" content="graphql基础知识">
    <meta name="twitter:url" content="/web/tool/graphql-basic.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="graphql, api, http">
    <meta property="article:tag" content="graphql">
  <link rel="preload" href="/assets/css/0.styles.28933c33.css" as="style"><link rel="preload" href="/assets/js/app.e36d51ee.js" as="script"><link rel="preload" href="/assets/js/2.30ada3ab.js" as="script"><link rel="preload" href="/assets/js/60.b5658dd6.js" as="script"><link rel="prefetch" href="/assets/js/10.ff2015f7.js"><link rel="prefetch" href="/assets/js/11.dc0bda68.js"><link rel="prefetch" href="/assets/js/12.47e1f8ef.js"><link rel="prefetch" href="/assets/js/13.26b57369.js"><link rel="prefetch" href="/assets/js/14.a517a293.js"><link rel="prefetch" href="/assets/js/15.8d5ffb8f.js"><link rel="prefetch" href="/assets/js/16.c783d5d0.js"><link rel="prefetch" href="/assets/js/17.9706c121.js"><link rel="prefetch" href="/assets/js/18.dfeae582.js"><link rel="prefetch" href="/assets/js/19.4d39bc3e.js"><link rel="prefetch" href="/assets/js/20.6c9eae9e.js"><link rel="prefetch" href="/assets/js/21.7e06b58f.js"><link rel="prefetch" href="/assets/js/22.7dd0c748.js"><link rel="prefetch" href="/assets/js/23.f796c70a.js"><link rel="prefetch" href="/assets/js/24.7054606e.js"><link rel="prefetch" href="/assets/js/25.64b34905.js"><link rel="prefetch" href="/assets/js/26.5f36168f.js"><link rel="prefetch" href="/assets/js/27.d03deebf.js"><link rel="prefetch" href="/assets/js/28.38678ff8.js"><link rel="prefetch" href="/assets/js/29.b3eae5f3.js"><link rel="prefetch" href="/assets/js/3.fbba67ee.js"><link rel="prefetch" href="/assets/js/30.397a4535.js"><link rel="prefetch" href="/assets/js/31.1a4dad4d.js"><link rel="prefetch" href="/assets/js/32.6a73c055.js"><link rel="prefetch" href="/assets/js/33.c7e3d855.js"><link rel="prefetch" href="/assets/js/34.5fcddb60.js"><link rel="prefetch" href="/assets/js/35.bf32c18d.js"><link rel="prefetch" href="/assets/js/36.4918b379.js"><link rel="prefetch" href="/assets/js/37.af0ca8d1.js"><link rel="prefetch" href="/assets/js/38.7ce94887.js"><link rel="prefetch" href="/assets/js/39.ed1b2a02.js"><link rel="prefetch" href="/assets/js/4.b0f615bf.js"><link rel="prefetch" href="/assets/js/40.1dcadf34.js"><link rel="prefetch" href="/assets/js/41.9db44a51.js"><link rel="prefetch" href="/assets/js/42.6f8f1a9f.js"><link rel="prefetch" href="/assets/js/43.48263291.js"><link rel="prefetch" href="/assets/js/44.6b65eeda.js"><link rel="prefetch" href="/assets/js/45.c1854ac2.js"><link rel="prefetch" href="/assets/js/46.682b3bdd.js"><link rel="prefetch" href="/assets/js/47.281957af.js"><link rel="prefetch" href="/assets/js/48.5c57cd1f.js"><link rel="prefetch" href="/assets/js/49.2e4db557.js"><link rel="prefetch" href="/assets/js/5.067e01ad.js"><link rel="prefetch" href="/assets/js/50.81864675.js"><link rel="prefetch" href="/assets/js/51.c79fbdd8.js"><link rel="prefetch" href="/assets/js/52.be7172a4.js"><link rel="prefetch" href="/assets/js/53.20c9887c.js"><link rel="prefetch" href="/assets/js/54.204bd570.js"><link rel="prefetch" href="/assets/js/55.4b07ee8b.js"><link rel="prefetch" href="/assets/js/56.97444045.js"><link rel="prefetch" href="/assets/js/57.023beaed.js"><link rel="prefetch" href="/assets/js/58.e0b7758b.js"><link rel="prefetch" href="/assets/js/59.4d4b32a4.js"><link rel="prefetch" href="/assets/js/6.7f2087be.js"><link rel="prefetch" href="/assets/js/61.87a0eb15.js"><link rel="prefetch" href="/assets/js/62.127f0440.js"><link rel="prefetch" href="/assets/js/63.10f2739a.js"><link rel="prefetch" href="/assets/js/64.5110fc71.js"><link rel="prefetch" href="/assets/js/65.da49b40b.js"><link rel="prefetch" href="/assets/js/66.d27d347b.js"><link rel="prefetch" href="/assets/js/67.17b44327.js"><link rel="prefetch" href="/assets/js/68.c06b126b.js"><link rel="prefetch" href="/assets/js/69.94cd5f9d.js"><link rel="prefetch" href="/assets/js/7.8a8f83df.js"><link rel="prefetch" href="/assets/js/70.6bd6174b.js"><link rel="prefetch" href="/assets/js/71.b9cf8f3b.js"><link rel="prefetch" href="/assets/js/72.3403b2e2.js"><link rel="prefetch" href="/assets/js/73.49ff4f15.js"><link rel="prefetch" href="/assets/js/74.53f8d4e1.js"><link rel="prefetch" href="/assets/js/75.89ebcfb0.js"><link rel="prefetch" href="/assets/js/8.36183b1b.js"><link rel="prefetch" href="/assets/js/9.ba89c97a.js">
  <link rel="stylesheet" href="/assets/css/0.styles.28933c33.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">从零开始的故事</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  前端笔记
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://github.com/Rem486/Rem486.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  前端笔记
</a></div><div class="nav-item"><a href="/life/" class="nav-link">
  生活
</a></div><div class="nav-item"><a href="https://github.com/Rem486/Rem486.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web/" aria-current="page" class="sidebar-link">前端笔记</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/css/android-disable-img-preview.html" class="sidebar-link">禁用安卓点击图片预览</a></li><li><a href="/web/css/chrome-scroll-bar.html" class="sidebar-link">chrome自定义滚动条样式</a></li><li><a href="/web/css/css-hack.html" class="sidebar-link">css - hack</a></li><li><a href="/web/css/css-name.html" class="sidebar-link">css - 命名规范</a></li><li><a href="/web/css/img-auto-size.html" class="sidebar-link">图片自适应宽高</a></li><li><a href="/web/css/inline-block-overflow-hidden.html" class="sidebar-link">inline-block 对齐</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/js/object-oriented-programming.html" class="sidebar-link">面向对象编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/mobile/mobile-scroll-through.html" class="sidebar-link">滚动穿透</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/tool/babel-basic.html" class="sidebar-link">babel-basic</a></li><li><a href="/web/tool/babel-translate.html" class="sidebar-link">babel - preset-env和polyfill</a></li><li><a href="/web/tool/bash-pwd.html" class="sidebar-link">bash - 获取脚本的运行目录</a></li><li><a href="/web/tool/core-js.html" class="sidebar-link">core-js</a></li><li><a href="/web/tool/git-set-origin-url.html" class="sidebar-link">git - 配置/修改远程仓库地址</a></li><li><a href="/web/tool/git-delete-branch.html" class="sidebar-link">git - 删除远程分支</a></li><li><a href="/web/tool/git-minor-version.html" class="sidebar-link">git - 快速获取小版本</a></li><li><a href="/web/tool/git-command.html" class="sidebar-link">git - 常用命令</a></li><li><a href="/web/tool/http-status.html" class="sidebar-link">http - 状态码</a></li><li><a href="/web/tool/http-TIME_WAIT-CLOSE_WAIT.html" class="sidebar-link">http - TIMEWAIT，CLOSEWAIT异常</a></li><li><a href="/web/tool/JSON-schema-basic.html" class="sidebar-link">JSON Schema - 入门</a></li><li><a href="/web/tool/ssh-password-free-login.html" class="sidebar-link">ssh - 免密登录及设置多个key</a></li><li><a href="/web/tool/npm-common-use-tips.html" class="sidebar-link">npm - 常用操作技巧</a></li><li><a href="/web/tool/npm-package.json.html" class="sidebar-link">npm - package.json属性详解</a></li><li><a href="/web/tool/npm-version-management.html" class="sidebar-link">npm - 管理项目版本号</a></li><li><a href="/web/tool/npm-update-package.html" class="sidebar-link">npm - 一键更新依赖包</a></li><li><a href="/web/tool/reg-basic.html" class="sidebar-link">正则 - 入门</a></li><li><a href="/web/tool/reg-escape.html" class="sidebar-link">正则 - 转义特殊字符</a></li><li><a href="/web/tool/md-basic.html" class="sidebar-link">Markdown 基本语法</a></li><li><a href="/web/tool/webpack-error.html" class="sidebar-link">webpack - 常见错误</a></li><li><a href="/web/tool/webpack-split-chunks.html" class="sidebar-link">webpack - 使用 splitChunks 分离第三方库</a></li><li><a href="/web/tool/yarn-npm-clean-cache.html" class="sidebar-link">yarn 和 npm - 清理缓存包</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>环境</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/env/docker-error.html" class="sidebar-link">docker - 常见报错</a></li><li><a href="/web/env/linux-command.html" class="sidebar-link">linux - 常用命令</a></li><li><a href="/web/env/linux-dns.html" class="sidebar-link">linux - 修改DNS</a></li><li><a href="/web/env/node-version-control.html" class="sidebar-link">管理nodejs版本</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/database/mongodb-error.html" class="sidebar-link">mongodb - 常见错误</a></li><li><a href="/web/database/mongodb-memo.html" class="sidebar-link">mongodb - 备忘录</a></li><li><a href="/web/database/mysql-start-stop.html" class="sidebar-link">mysql - 启动和关闭</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>杂项</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/other/article-collection.html" class="sidebar-link">文档收藏</a></li><li><a href="/web/other/node-spider-basic.html" class="sidebar-link">node - 爬虫初体验</a></li><li><a href="/web/other/idea-registered.html" class="sidebar-link">idea - 注册码持续更新</a></li><li><a href="/web/other/ie-image-dom7009.html" class="sidebar-link">IE - 图片加载报错DOM7009</a></li><li><a href="/web/other/mac-modify-host.html" class="sidebar-link">mac修改host</a></li><li><a href="/web/other/socket-error.html" class="sidebar-link">socket - 常见错误</a></li><li><a href="/web/other/timestamp-basic.html" class="sidebar-link">timestamp - 日期格式</a></li><li><a href="/web/other/websocket-basic.html" class="sidebar-link">webSocket - 入门</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="graphql-入门"><a href="#graphql-入门" class="header-anchor">#</a> graphql - 入门</h1> <h2 id="什么是api"><a href="#什么是api" class="header-anchor">#</a> 什么是API</h2> <blockquote><p>如果问上学的时候的我，我会说 API 就是 Application programming interface，这个时候HR就会不懂装懂地点点头然后让我进入下一轮面试。
如果问刚刚工作的我，我会说 API 就是接口嘛！PM灵光一现想出了一个新功能，我花几天时间写一个 API，把这个功能体现出来，前端做网页做APP的人可以用。
API 可以从封装方式来区分。主要是两个流派，一派是基于 REST，一派是基于 RPC。REST 是用 HTTP 封装，而 RPS 往往用自定义的协议封装。今天 REST 这一派衍生出了 GraphQL，而 RPC 这一派衍生出了 gRPC。这四种到底该用哪种，是今天互联网公司的日常争论。最后往往要吵到最核心的API定义：API到底是用来干什么的。</p></blockquote> <p>API 的本质就是帮人读数据、写数据。</p> <h2 id="graphql"><a href="#graphql" class="header-anchor">#</a> GraphQL</h2> <p>有几个特点：</p> <ul><li>不需要GET、POST、PUT、DELETE这么多动作，一切简化为读和写</li> <li>Response 不会一次给全部数据，用的时候要什么，服务器就返回什么</li> <li>PostBody 可以加入 variable</li> <li>写 API 之前先写 Schema，一切数据都得定义类型</li> <li>数据 Dependency 必须确立好，这样 Resource 结构一目了然</li></ul> <h2 id="query-mutation"><a href="#query-mutation" class="header-anchor">#</a> Query &amp; Mutation</h2> <ul><li>查询（Query） 和变更（Mutation） 是 GraphQL 的两大支柱；</li> <li>GraphQL 始终返回 JSON 对象；</li> <li>GraphQL error 也是返回 200；</li> <li>片段（Fragment） 和 变量（Variable）可以显著优化查询操作；</li> <li>只选择需要的字段（Field）可以提升性能；</li> <li>类型系统（Type System）可以帮助 API 服务做类型检查；</li> <li>查询操作是并行执行的，变更操作是依次执行的（这是为了防止竞争条件（Race Condition））；</li> <li>可以使用 <code>__typename</code> 来获取元字段，允许在查询的任何位置使用，以获得对象的类型名称。区分联合类型的时候有用；</li> <li>使用 <code>__type</code> 来查询 Schema；</li></ul> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token punctuation">{</span>
  __type<span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">:</span><span class="token string">&quot;Mutation&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name
    fields <span class="token punctuation">{</span>
      name
      <span class="token keyword">type</span><span class="token punctuation">{</span>
        name
      <span class="token punctuation">}</span>
      args<span class="token punctuation">{</span>
        name
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="schema-type"><a href="#schema-type" class="header-anchor">#</a> Schema &amp; Type</h2> <ul><li>GraphQL 有自己的简单语言 <code>GraphQL schema language</code>，来定义类型（Type）；</li> <li>! 表示非空（non-nullable）；</li> <li>[] 表示返回对应类型的数组;</li> <li>Root Schema</li></ul> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">schema</span> <span class="token punctuation">{</span>
  <span class="token attr-name">query</span><span class="token punctuation">:</span> Query
  <span class="token attr-name">mutation</span><span class="token punctuation">:</span> Mutation
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Query 和 Mutation 也都是对象（Object）。所以 GraphQL 是面向对象编程（object-oriented-programming）；</p> <ul><li>GraphQL 基本上是一棵树（tree），标量（scalar）类型是叶子节点（leave node）；</li> <li>GraphQL 提供了一组开箱即用的默认标量类型：
<ul><li>Int: 有符号32位整数.</li> <li>Float: 有符号双精度浮点数.</li> <li>String: UTF-8字符序列.</li> <li>Boolean: 布尔值.</li> <li>ID: 表示唯一的标识符，通常用于重新获取对象或用作缓存的键。ID 类型的序列化方法与 String 相同。但是，将其定义为 ID 表示它并不需要 human‐readable。</li></ul></li> <li>也可以自定义标量类型。例如，定义一个 Date 类型：</li></ul> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">scalar</span> <span class="token class-name">Date</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>枚举类型是一种特殊的标量，它限制在一个特殊的可选值集合内，定义枚举类型：</li></ul> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">enum</span> <span class="token class-name">Name</span> <span class="token punctuation">{</span>
  ZhangSan
  LiSi
  WangErMaZi
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>接口（Interface）是一种抽象类型，它定义了一个类型必须包含的某些字段（OOP）；</li> <li>联合（Union）类型基本上是或（OR）逻辑；</li></ul> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">union</span> <span class="token class-name">SearchResult</span> <span class="token operator">=</span> Human <span class="token operator">|</span> Droid <span class="token operator">|</span> Starship
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>注意，联合类型的成员需要是具体对象类型；你不能使用接口或者其他联合类型来创造一个联合类型；</li> <li>输入（Input）对象看上去和常规对象一模一样，除了关键字是 input 而不是 type</li></ul> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">input</span> ReviewInput <span class="token punctuation">{</span> 
  <span class="token attr-name">stars</span><span class="token punctuation">:</span> Int<span class="token operator">!</span> 
  <span class="token attr-name">commentary</span><span class="token punctuation">:</span> String 
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>不能在 schema 中混淆输入和输出类型；</li></ul> <h2 id="validation"><a href="#validation" class="header-anchor">#</a> Validation</h2> <ul><li>I think when they invented GraphQL, they want to call it TreeQL, but then realized that object relationship can be pointing backward, like a graph. So TreeQL becomes GraphQL.</li> <li>片段不能引用其自身或者创造回环，因为这会导致结果无边界；</li></ul> <p>这个查询是有效的：</p> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token punctuation">{</span> 
  hero <span class="token punctuation">{</span> 
    <span class="token operator">...</span><span class="token fragment function">NameAndAppearances</span> 
    friends <span class="token punctuation">{</span> 
      <span class="token operator">...</span><span class="token fragment function">NameAndAppearances</span> 
      friends <span class="token punctuation">{</span> 
        <span class="token operator">...</span><span class="token fragment function">NameAndAppearances</span> 
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token keyword">fragment</span> <span class="token fragment function">NameAndAppearances</span> <span class="token keyword">on</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span> 
    name 
    appearsIn 
  <span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>无效查询：</p> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">fragment</span> <span class="token fragment function">NameAndAppearancesAndFriends</span> <span class="token keyword">on</span> <span class="token class-name">Character</span> <span class="token punctuation">{</span> 
  name 
  appearsIn 
  friends <span class="token punctuation">{</span> 
    <span class="token operator">...</span><span class="token fragment function">NameAndAppearancesAndFriends</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>查询规则：
<ul><li>只能查询给定类型上的字段；</li> <li>返回值不是标量或者枚举型，需要指明要从字段中获取的数据；(i.e. 始终以叶子节点结尾)</li></ul></li></ul> <h2 id="execution"><a href="#execution" class="header-anchor">#</a> Execution</h2> <ul><li>每个类型的每个字段都由一个 resolver 函数支持，该函数产生下一个值(就像 OOP)。如果字段产生标量值，例如字符串或数字，则执行完成。如果一个字段产生一个对象，则该查询将继续执行该对象对应字段的解析器，直到生成标量值。GraphQL 查询始终以标量值结束。</li> <li>这是一个 js 的 resolver 例子：</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>Query: { 
  human(obj, args, context, info) { 
    return context.db.loadHumanByID(args.id).then( 
      userData =&gt; new Human(userData) 
    ) 
  } 
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>因为从数据库拉取数据的过程是一个异步操作，该方法返回了一个 Promise 对象。解析器能感知到 Promise 的进度，在获取到数据后，由于类型系统确定了 human 字段将返回一个 Human 对象，GraphQL 会根据类型系统预设好的 Human 类型决定如何解析字段。</p> <h2 id="introspection"><a href="#introspection" class="header-anchor">#</a> Introspection</h2> <p>如果是我们亲自设计了类型，那我们自然知道哪些类型是可用的。但如果类型不是我们设计的，我们也可以通过查询 __schema 字段来向 GraphQL 询问哪些类型是可用的。</p> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token punctuation">{</span>
  __schema <span class="token punctuation">{</span>
    types <span class="token punctuation">{</span>
      name
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Response:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;__schema&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MessageInput&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Message&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ID&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Int&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Query&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Mutation&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Boolean&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__Schema&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__Type&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__TypeKind&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__Field&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__InputValue&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__EnumValue&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__Directive&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;__DirectiveLocation&quot;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>返回的类型主要包括：</p> <ul><li>Query, Mutation, Message, MessageInput - 这些是我们在类型系统中定义的类型；</li> <li>String, Boolean - 这些是内建的标量，由类型系统提供；</li> <li>__Schema, __Type, __TypeKind, __Field, __InputValue, __EnumValue, __Directive - 这些有着两个下划线的类型是内省系统的一部分；</li></ul> <p>继续查询 <code>Query</code>：</p> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token punctuation">{</span>
  __type<span class="token punctuation">(</span><span class="token attr-name">name</span><span class="token punctuation">:</span><span class="token string">&quot;Query&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name
    kind
    fields <span class="token punctuation">{</span>
      name
      <span class="token keyword">type</span><span class="token punctuation">{</span>
        kind
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>Response:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;__type&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Query&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OBJECT&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getMessage&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OBJECT&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;getAllMessage&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;kind&quot;</span><span class="token operator">:</span> <span class="token string">&quot;LIST&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>Query 是一个 <code>OBJECT</code>，有两个字段 <code>getMessage</code> 和 <code>getAllMessage</code></p> <h2 id="best-practice"><a href="#best-practice" class="header-anchor">#</a> Best practice</h2> <ul><li>HTTP</li></ul> <p>Good: 通过单入口来提供 HTTP 服务的完整功能（Query &amp; Mutation）；
Bad: 通过暴露一组 URL 且每个 URL 只暴露一个资源； (虽然 GraphQL 也可以暴露多个资源 URL 来使用，但这可能导致在使用 <a href="https://github.com/graphql/graphiql" target="_blank" rel="noopener noreferrer">GraphiQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 等工具时遇到困难。)</p> <ul><li>JSON：使用 JSON 并开启 GZIP 压缩，<code>Accept-Encoding: gzip</code></li> <li>空：在 GraphQL 类型系统中，默认情况下每个字段都<code>可以为空</code>。用来避免各种异常情况下请求完全失败。</li> <li>GraphQL 服务可能会像&quot;聊天&quot;一样反复从您的数据库加载数据, 考虑通过批处理和缓存来优化性能。</li> <li>可视化工具 <a href="https://github.com/APIs-guru/graphql-voyager" target="_blank" rel="noopener noreferrer">graphql-voyager<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>In the pipeline of API middleware, place graphql after authentication
GraphQL only use GET and POST. For GET, accept <code>?query=...&amp;variables=...&amp;operationName=...</code>
Accept header <code>Content-Type:application/json</code>
Response should be like
{
&quot;data&quot;: { ... },
&quot;errors&quot;: [ ... ]
}
If there were no errors returned, the &quot;errors&quot; field should not be present on the response. If no data is returned, according to the GraphQL spec, the &quot;data&quot; field should only be included if the error occurred during execution.</p> <p>Please disable GraphiQL for production
Don't do business layer authorization in GraphQL (or any API) layer. Do it in business layer.
For pagination, cursor-based pagination is the most powerful. Better use a base64 encoded form (so that the format is not intuitive thus no one will rely upon it)
This is a good example of pagination (github graphQL)
Request:</p> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">query</span> myRepositories <span class="token punctuation">{</span> 
  viewer <span class="token punctuation">{</span> 
    login 
    repositories<span class="token punctuation">(</span><span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token attr-name">orderBy</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token attr-name">field</span><span class="token punctuation">:</span> <span class="token constant">UPDATED_AT</span><span class="token punctuation">,</span> <span class="token attr-name">direction</span><span class="token punctuation">:</span> <span class="token constant">DESC</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      edges <span class="token punctuation">{</span> 
        cursor 
        node <span class="token punctuation">{</span> 
          name 
        <span class="token punctuation">}</span> 
      <span class="token punctuation">}</span> 
      pageInfo <span class="token punctuation">{</span> 
        endCursor 
        hasNextPage 
      <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Response:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span> 
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
        <span class="token property">&quot;viewer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
            <span class="token property">&quot;login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;quzhi1&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;repositories&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
                <span class="token property">&quot;edges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> 
                    <span class="token punctuation">{</span> 
                        <span class="token property">&quot;cursor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Y3Vyc29yOnYyOpK5MjAyMC0wMi0wMlQxNTozNzowMS0wODowMM4K7LIe&quot;</span><span class="token punctuation">,</span> 
                        <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
                            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;InterativeHistoryMapSinatra&quot;</span> 
                        <span class="token punctuation">}</span> 
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> 
                    <span class="token punctuation">{</span> 
                        <span class="token property">&quot;cursor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Y3Vyc29yOnYyOpK5MjAyMC0wMS0yMFQxNDozOTo0Mi0wODowMM4N6ph9&quot;</span><span class="token punctuation">,</span> 
                        <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
                            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rails_playground&quot;</span> 
                        <span class="token punctuation">}</span> 
                    <span class="token punctuation">}</span> 
                <span class="token punctuation">]</span><span class="token punctuation">,</span> 
                <span class="token property">&quot;pageInfo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
                    <span class="token property">&quot;endCursor&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Y3Vyc29yOnYyOpK5MjAyMC0wMS0yMFQxNDozOTo0Mi0wODowMM4N6ph9&quot;</span><span class="token punctuation">,</span> 
                    <span class="token property">&quot;hasNextPage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> 
                <span class="token punctuation">}</span> 
            <span class="token punctuation">}</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ul><li><p>Note 1: If you base64 decode the cursor, it has format like this <code>cursor:v2:2020-02-02T15:37:01-08:00</code></p></li> <li><p>Note 2: Cursor is on edge, not on node. &quot;Edge&quot; and &quot;node&quot; concept will let people know cursor is not a property of object, but the connection.</p></li> <li><p>Note 3: PageInfo will tell you whether we reached the end of the list.</p></li> <li><p>Note 4: With pageInfo, you don't even need the cursor field on each edge.</p></li></ul> <p>Global object identification
Every object should have an id. In this way you can fetch any object with this query:</p> <div class="language-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">query</span> retrieveNodeById <span class="token punctuation">{</span> 
  node<span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token string">&quot;MDQ6VXNlcjU1NzI1MzU=&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    id 
    <span class="token operator">...</span> <span class="token keyword">on</span> <span class="token class-name">User</span> <span class="token punctuation">{</span> 
        login 
        bio 
        company 
        <span class="token attr-name">myEmail</span><span class="token punctuation">:</span> email 
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>And the response is:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span> 
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
        <span class="token property">&quot;node&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> 
            <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MDQ6VXNlcjU1NzI1MzU=&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;login&quot;</span><span class="token operator">:</span> <span class="token string">&quot;quzhi1&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;bio&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;company&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Stripe&quot;</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;myEmail&quot;</span><span class="token operator">:</span> <span class="token string">&quot;quzhi65222714@gmail.com&quot;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span> 
<span class="token punctuation">}</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>Note 1
The object id in Github is actually a base64 encoding.</p> <p>User id &quot;MDQ6VXNlcjU1NzI1MzU=&quot; =&gt; &quot;04:User5572535&quot;
Repository id &quot;MDEwOlJlcG9zaXRvcnkzODE3NjgwMg==&quot; =&gt; &quot;010:Repository38176802&quot;
Issue id &quot;MDU6SXNzdWU1Njg2MDM4MTY=&quot; =&gt; &quot;05:Issue568603816&quot;
So my guess is, their global id is &lt;database_shard&gt;:&lt;object_type&gt;&lt;database_key&gt;</p> <p>Note 2
If the id is the same, it must be the same object.</p> <p>Note 3:
This design is good, because when you fetch N items, you will get exactly N result. If one of the N items turns out to be null, then you will get null in place. You will love this when doing batch! (Think about Yahoo's sherpa batch api as a lesson)</p> <p>Note 4
Global object id can be used in caching too. In the past, people will use cache key like <code>&lt;url&gt;:&lt;response&gt;</code>. Now, people can do <code>&lt;object_id&gt;:&lt;object&gt;</code>.</p> <p><strong>参考</strong></p> <ul><li><a href="https://graphql.cn/learn/" target="_blank" rel="noopener noreferrer">GraphQL 入门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/109424841" target="_blank" rel="noopener noreferrer">【从初学到放弃】GraphQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
<script src="/assets/js/app.e36d51ee.js" defer></script><script src="/assets/js/2.30ada3ab.js" defer></script><script src="/assets/js/60.b5658dd6.js" defer></script>
<a style="text-align: center;display: block" href="https://beian.miit.gov.cn">蜀ICP备18030457号-1</a>
</body>
<script type="text/javascript" async
        src="//s5.cnzz.com/z_stat.php?id=1275911745&web_id=1275911745&show=none"></script>
<script>
(function () {
  var bp = document.createElement('script');
  // var curProtocol = window.location.protocol.split(':')[0];
  // if (curProtocol === 'https') {
  //   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  // }
  // else {
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  // }
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>
</html>
