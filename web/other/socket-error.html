<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>socket - 常见错误 | 从零开始的Rem486</title>
  <meta name="description" content="socket常见错误的含义及解决方案">
  <meta name="keywords" content="前端博客,前端知识,前端备忘录,程序员笔记,css,html,javascript,git,linux">
  <meta name="baidu-site-verification" content="utzmmiwMvm"/>
  <link rel="icon" href="/img/logo.ico">
  <meta property="article:published_time" content="2020-06-02T00:00:00.000Z"><meta property="article:modified_time" content="2020-06-02T09:06:17.000Z"><meta property="og:site_name" content="从零开始的Rem486"><meta property="og:title" content="socket - 常见错误"><meta property="og:description" content="socket常见错误的含义及解决方案"><meta property="og:type" content="website"><meta property="og:url" content="/web/other/socket-error.html"><meta name="twitter:title" content="socket - 常见错误"><meta name="twitter:description" content="socket常见错误的含义及解决方案"><meta name="twitter:url" content="/web/other/socket-error.html"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:label2" content="Filed under"><meta name="twitter:data2" content="socket, ECONNRESET, ECONNABORTED, EPROTO, EPIPE"><meta property="article:tag" content="socket"><meta property="article:tag" content="ECONNRESET"><meta property="article:tag" content="ECONNABORTED"><meta property="article:tag" content="EPROTO"><meta property="article:tag" content="EPIPE">
  <link rel="preload" href="/assets/css/0.styles.ef41ae34.css" as="style"><link rel="preload" href="/assets/js/app.ff4b97a8.js" as="script"><link rel="preload" href="/assets/js/2.7ada23cf.js" as="script"><link rel="preload" href="/assets/js/35.d040bee0.js" as="script"><link rel="prefetch" href="/assets/js/10.f60cf560.js"><link rel="prefetch" href="/assets/js/11.fa07c0e4.js"><link rel="prefetch" href="/assets/js/12.872d4c05.js"><link rel="prefetch" href="/assets/js/13.9ea74b09.js"><link rel="prefetch" href="/assets/js/14.f0e24bca.js"><link rel="prefetch" href="/assets/js/15.92a310af.js"><link rel="prefetch" href="/assets/js/16.222fe86c.js"><link rel="prefetch" href="/assets/js/17.296c9b13.js"><link rel="prefetch" href="/assets/js/18.269e1012.js"><link rel="prefetch" href="/assets/js/19.b21401c9.js"><link rel="prefetch" href="/assets/js/20.4342ae11.js"><link rel="prefetch" href="/assets/js/21.97357ebd.js"><link rel="prefetch" href="/assets/js/22.23dbb1ec.js"><link rel="prefetch" href="/assets/js/23.d6ce72f3.js"><link rel="prefetch" href="/assets/js/24.f1fae47c.js"><link rel="prefetch" href="/assets/js/25.be56c080.js"><link rel="prefetch" href="/assets/js/26.601cacbd.js"><link rel="prefetch" href="/assets/js/27.0bb24d1d.js"><link rel="prefetch" href="/assets/js/28.9f055545.js"><link rel="prefetch" href="/assets/js/29.8b9f44f1.js"><link rel="prefetch" href="/assets/js/3.11c745f0.js"><link rel="prefetch" href="/assets/js/30.df1aea91.js"><link rel="prefetch" href="/assets/js/31.1204f5fc.js"><link rel="prefetch" href="/assets/js/32.160f8fcc.js"><link rel="prefetch" href="/assets/js/33.6d2afecf.js"><link rel="prefetch" href="/assets/js/34.c98e551d.js"><link rel="prefetch" href="/assets/js/36.9d1a5ef0.js"><link rel="prefetch" href="/assets/js/37.a33e2a4c.js"><link rel="prefetch" href="/assets/js/38.fb6286b7.js"><link rel="prefetch" href="/assets/js/39.7c46e234.js"><link rel="prefetch" href="/assets/js/4.e8819c6a.js"><link rel="prefetch" href="/assets/js/40.25c8539b.js"><link rel="prefetch" href="/assets/js/41.f562ae7f.js"><link rel="prefetch" href="/assets/js/42.d1f567a3.js"><link rel="prefetch" href="/assets/js/43.485931cc.js"><link rel="prefetch" href="/assets/js/44.bcb4361b.js"><link rel="prefetch" href="/assets/js/45.dcf9b7f7.js"><link rel="prefetch" href="/assets/js/46.da460588.js"><link rel="prefetch" href="/assets/js/47.e580e87a.js"><link rel="prefetch" href="/assets/js/48.401c3bd1.js"><link rel="prefetch" href="/assets/js/49.0bbebca4.js"><link rel="prefetch" href="/assets/js/5.845eed76.js"><link rel="prefetch" href="/assets/js/50.9fb93c00.js"><link rel="prefetch" href="/assets/js/51.e05ba806.js"><link rel="prefetch" href="/assets/js/52.1a6aba62.js"><link rel="prefetch" href="/assets/js/53.00754072.js"><link rel="prefetch" href="/assets/js/54.78923e1d.js"><link rel="prefetch" href="/assets/js/55.88c7e5a6.js"><link rel="prefetch" href="/assets/js/56.0e72705c.js"><link rel="prefetch" href="/assets/js/57.a0f374d1.js"><link rel="prefetch" href="/assets/js/6.e917c29b.js"><link rel="prefetch" href="/assets/js/7.de072662.js"><link rel="prefetch" href="/assets/js/8.27a05a6a.js"><link rel="prefetch" href="/assets/js/9.db3a6f81.js">
  <link rel="stylesheet" href="/assets/css/0.styles.ef41ae34.css">
</head>
<body>
<div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">从零开始的Rem486</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  前端笔记
</a></div><div class="nav-item"><a href="https://github.com/Rem486/Rem486.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/web/" class="nav-link router-link-active">
  前端笔记
</a></div><div class="nav-item"><a href="https://github.com/Rem486/Rem486.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web/" class="sidebar-link">前端笔记</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/css/android-disable-img-preview.html" class="sidebar-link">禁用安卓点击图片预览</a></li><li><a href="/web/css/chrome-scroll-bar.html" class="sidebar-link">chrome自定义滚动条样式</a></li><li><a href="/web/css/css-hack.html" class="sidebar-link">css - hack</a></li><li><a href="/web/css/img-auto-size.html" class="sidebar-link">图片自适应宽高</a></li><li><a href="/web/css/inline-block-overflow-hidden.html" class="sidebar-link">inline-block 对齐</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/js/object-oriented-programming.html" class="sidebar-link">面向对象编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>移动端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/mobile/mobile-scroll-through.html" class="sidebar-link">滚动穿透</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/tool/git-set-origin-url.html" class="sidebar-link">git - 配置/修改远程仓库地址</a></li><li><a href="/web/tool/git-delete-branch.html" class="sidebar-link">git - 删除远程分支</a></li><li><a href="/web/tool/git-minor-version.html" class="sidebar-link">git - 快速获取小版本</a></li><li><a href="/web/tool/git-command.html" class="sidebar-link">git - 常用命令</a></li><li><a href="/web/tool/http-status.html" class="sidebar-link">http - 状态码</a></li><li><a href="/web/tool/http-TIME_WAIT-CLOSE_WAIT.html" class="sidebar-link">http - TIMEWAIT，CLOSEWAIT异常</a></li><li><a href="/web/tool/linux-command.html" class="sidebar-link">linux - 常用命令</a></li><li><a href="/web/tool/ssh-password-free-login.html" class="sidebar-link">ssh - 免密登录及设置多个key</a></li><li><a href="/web/tool/npm-common-use-tips.html" class="sidebar-link">npm - 常用操作技巧</a></li><li><a href="/web/tool/npm-package.json.html" class="sidebar-link">npm - package.json属性详解</a></li><li><a href="/web/tool/npm-version-management.html" class="sidebar-link">npm - 管理项目版本号</a></li><li><a href="/web/tool/reg-basic.html" class="sidebar-link">正则 - 入门</a></li><li><a href="/web/tool/reg-escape.html" class="sidebar-link">正则 - 转义特殊字符</a></li><li><a href="/web/tool/md-basic.html" class="sidebar-link">Markdown 基本语法</a></li><li><a href="/web/tool/node-version-control.html" class="sidebar-link">管理nodejs版本</a></li><li><a href="/web/tool/webpack-error.html" class="sidebar-link">webpack - 常见错误</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/database/mongodb-error.html" class="sidebar-link">mongodb - 常见错误</a></li><li><a href="/web/database/mongodb-memo.html" class="sidebar-link">mongodb - 备忘录</a></li><li><a href="/web/database/mysql-start-stop.html" class="sidebar-link">mysql - 启动和关闭</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>杂项</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/other/article-collection.html" class="sidebar-link">文档收藏</a></li><li><a href="/web/other/node-spider-basic.html" class="sidebar-link">node - 爬虫初体验</a></li><li><a href="/web/other/idea-registered.html" class="sidebar-link">idea - 注册码持续更新</a></li><li><a href="/web/other/mac-modify-host.html" class="sidebar-link">mac修改host</a></li><li><a href="/web/other/socket-error.html" class="active sidebar-link">socket - 常见错误</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/other/socket-error.html#econnreset" class="sidebar-link">ECONNRESET</a></li><li class="sidebar-sub-header"><a href="/web/other/socket-error.html#econnaborted" class="sidebar-link">ECONNABORTED</a></li><li class="sidebar-sub-header"><a href="/web/other/socket-error.html#eproto" class="sidebar-link">EPROTO</a></li><li class="sidebar-sub-header"><a href="/web/other/socket-error.html#epipe" class="sidebar-link">EPIPE</a></li><li class="sidebar-sub-header"><a href="/web/other/socket-error.html#econnrefused" class="sidebar-link">ECONNREFUSED</a></li><li class="sidebar-sub-header"><a href="/web/other/socket-error.html#etimeout" class="sidebar-link">ETIMEOUT</a></li></ul></li><li><a href="/web/other/websocket-basic.html" class="sidebar-link">webSocket - 入门</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="socket-常见错误"><a href="#socket-常见错误" class="header-anchor">#</a> socket - 常见错误</h1> <p>最近在试着使用代理 <code>ip</code> 的时候，经常会遇到一些错误代码，查阅资料后了解到是 <code>Socket</code> 的错误。记录一下。</p> <h2 id="econnreset"><a href="#econnreset" class="header-anchor">#</a> ECONNRESET</h2> <p>远程主机重置连接请求。</p> <blockquote><p>该错误被描述为“connection reset by peer”，即“对方复位连接”，这种情况一般发生在服务进程较客户进程提前终止。当服务进程终止时会向客户 TCP 发送 FIN 分节，客户 TCP 回应 ACK，服务 TCP 将转入 FIN_WAIT2 状态。此时如果客户进程没有处理该 FIN （如阻塞在其它调用上而没有关闭 Socket 时），则客户 TCP 将处于 CLOSE_WAIT 状态。当客户进程再次向 FIN_WAIT2 状态的服务 TCP 发送数据时，则服务 TCP 将立刻响应 RST。一般来说，这种情况还可以会引发另外的应用程序异常，客户进程在发送完数据后，往往会等待从网络IO接收数据，很典型的如 read 或 readline 调用，此时由于执行时序的原因，如果该调用发生在 RST 分节收到前执行的话，那么结果是客户进程会得到一个非预期的 EOF 错误。此时一般会输出“server terminated prematurely”－“服务器过早终止”错误。</p></blockquote> <p>可能的原因：</p> <ul><li>socket 的 ECONNRESET 错误一般是因为TCP连接的一方突然关闭连接。http agent不能自己吞下（swallowed）这个错误，因为吞下后，比如你就不能通过这个错误分清由unclean termination造成的empty reply。</li> <li>socket 抛出未处理的 ECONNRESET，在不同版本的node中，有些版本这个错误是silent的，有些则直接抛出。silent是指这个错误不会向上抛出，比如uncaughtException不能捕获到这个错误。另外，http上是捕获不到这个错误的，必须在socket上监听。</li> <li>ECONNRESET是因为连接的一方突然关闭连接。为什么要关闭的原因有很多，可能是因为各种应用层协议错误，可能是达到硬件／软件支持的连接上限等等。</li></ul> <p>资料：</p> <ul><li><a href="https://github.com/nodejs/node/issues/3595" target="_blank" rel="noopener noreferrer">http.Agent: idle sockets throw unhandled ECONNRESET<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://stackoverflow.com/questions/17245881/node-js-econnreset" target="_blank" rel="noopener noreferrer">Node js ECONNRESET<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="econnaborted"><a href="#econnaborted" class="header-anchor">#</a> ECONNABORTED</h2> <p>客户端在服务器接受客户端请求的连接之前发送TCP重置（RST）。</p> <blockquote><p>该错误被描述为“software caused connection abort”，即“软件引起的连接中止”。原因在于当服务和客户进程在完成用于 TCP 连接的“三次握手”后，客户 TCP 却发送了一个 RST （复位）分节，在服务进程看来，就在该连接已由 TCP 排队，等着服务进程调用 accept 的时候 RST 却到达了。POSIX 规定此时的 errno 值必须 ECONNABORTED。源自 Berkeley 的实现完全在内核中处理中止的连接，服务进程将永远不知道该中止的发生。服务器进程一般可以忽略该错误，直接再次调用accept。</p></blockquote> <blockquote><p>考虑这种情况： TCP连接被客户端夭折，即在服务器调用accept之前，客户端主动发送RST终止连接，导致刚刚建立的连接从就绪队列中移出 ，如果套接口被设置成阻塞模式，服务器就会一直阻塞在accept调用上，直到其他某个客户建立一个新的连接为止。但是在此期间，服务器单纯地阻塞在accept调用上，就绪队列中的其他描述符都得不到处理。</p></blockquote> <blockquote><p>解决办法是把监听套接口设置为非阻塞，当客户在服务器调用accept之前中止某个连接时，accept调用可以立即返回-1，这时源自Berkeley的实现会在内核中处理该事件，并不会将该事件通知给epool，而其他实现把errno设置为ECONNABORTED或者EPROTO错误，我们应该忽略这两个错误。</p></blockquote> <p>就是 socket 刚建立，客户端立即发送了 RST ？不明白哪里发送了 RST，不过客户端遇到这种情况可以延时后直接重发请求。</p> <p>以 axios 为栗，添加拦截器：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置全局的请求次数，请求的间隙</span>
<span class="token comment">// axios.defaults.retry = 1; 原栗子是直接设置 defaults ，现在版本 `axios@0.19.2` 并不生效。</span>
<span class="token comment">// 折中方法，设置在 headers 里面 [custom config are now filtered out in v0.19](https://github.com/axios/axios/issues/164#issuecomment-524756674)</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">.</span>retry <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">.</span>retryDelay <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">axiosRetryInterceptor</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> config <span class="token punctuation">}</span> <span class="token operator">=</span> err<span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> headers <span class="token punctuation">}</span> <span class="token operator">=</span> config<span class="token punctuation">;</span>
  <span class="token comment">// 设置变量跟踪重试次数</span>
  config<span class="token punctuation">.</span>__retryCount <span class="token operator">=</span> config<span class="token punctuation">.</span>__retryCount <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token comment">// 如果不是 `ECONNABORTED`，或者 headers 不存在或未设置重试选项，或者已经达到最大重试总次数，抛出错误信息</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token string">'ECONNABORTED'</span> <span class="token operator">||</span> <span class="token operator">!</span>headers <span class="token operator">||</span> <span class="token operator">!</span>headers<span class="token punctuation">.</span>retry <span class="token operator">||</span> config<span class="token punctuation">.</span>__retryCount <span class="token operator">&gt;=</span> headers<span class="token punctuation">.</span>retry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 增加请求重试次数</span>
  config<span class="token punctuation">.</span>__retryCount <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>

  <span class="token comment">// 创建新的异步请求</span>
  <span class="token keyword">const</span> backOff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> headers<span class="token punctuation">.</span>retryDelay <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 返回一个新的请求</span>
  <span class="token keyword">return</span> backOff<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">axios</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 使用</span>
axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/some/endpoint'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> retry<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> retryDelay<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'failed'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h2 id="eproto"><a href="#eproto" class="header-anchor">#</a> EPROTO</h2> <p>协议错误。</p> <h2 id="epipe"><a href="#epipe" class="header-anchor">#</a> EPIPE</h2> <blockquote><p>错误被描述为“broken pipe”，即“管道破裂”，这种情况一般发生在客户进程不理会（或未及时处理）Socket 错误，继续向服务 TCP 写入更多数据时，内核将向客户进程发送 SIGPIPE 信号，该信号默认会使进程终止（此时该前台进程未进行 core dump）。结合上边的 ECONNRESET 错误可知，向一个 FIN_WAIT2 状态的服务 TCP（已 ACK 响应 FIN 分节）写入数据不成问题，但是写一个已接收了 RST 的 Socket 则是一个错误。</p></blockquote> <h2 id="econnrefused"><a href="#econnrefused" class="header-anchor">#</a> ECONNREFUSED</h2> <p>拒绝连接</p> <blockquote><p>1、一般发生在连接建立时。拔服务器端网线测试，客户端设置keep alive时，recv较快返回0， 先收到ECONNREFUSED (Connection refused)错误码，其后都是ETIMEOUT。
2、an error returned from connect(), so it can only occur in a client (if a client is defined as the party that initiates the connection</p></blockquote> <h2 id="etimeout"><a href="#etimeout" class="header-anchor">#</a> ETIMEOUT</h2> <blockquote><p>1、操作超时。一般设置了发送接收超时，遇到网络繁忙的情况，就会遇到这种错误。
2、服务器做了读数据做了超时限制，读时发生了超时。
3、错误被描述为“connect time out”，即“连接超时”，这种情况一般发生在服务器主机崩溃。此时客户 TCP 将在一定时间内（依具体实现）持续重发数据分节，试图从服务 TCP 获得一个 ACK 分节。当最终放弃尝试后（此时服务器未重新启动），内核将会向客户进程返回 ETIMEDOUT 错误。如果某个中间路由器判定该服务器主机已经不可达，则一般会响应“destination unreachable”－“目的地不可达”的ICMP消息，相应的客户进程返回的错误是 EHOSTUNREACH 或ENETUNREACH。当服务器重新启动后，由于 TCP 状态丢失，之前所有的连接信息也不存在了，此时对于客户端发来请求将回应 RST。如果客户进程对检测服务器主机是否崩溃很有必要，要求即使客户进程不主动发送数据也能检测出来，那么需要使用其它技术，如配置 SO_KEEPALIVE Socket 选项，或实现某些心跳函数。</p></blockquote> <h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <ul><li><a href="https://www.iteye.com/blog/lzy-383884" target="_blank" rel="noopener noreferrer">几个常见的 Socket 连接错误及原因<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/creeperyang/blog/issues/20#issuecomment-256678861" target="_blank" rel="noopener noreferrer">杂七杂八问题以及解决方案记录<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000015157929" target="_blank" rel="noopener noreferrer">axios请求超时,设置重新请求的完美解决方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/nellson/article/details/5669935" target="_blank" rel="noopener noreferrer">Linux网络编程socket错误分析<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">6/2/2020, 5:06:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/other/mac-modify-host.html" class="prev">
        mac修改host
      </a></span> <span class="next"><a href="/web/other/websocket-basic.html">
        webSocket - 入门
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
<script src="/assets/js/app.ff4b97a8.js" defer></script><script src="/assets/js/2.7ada23cf.js" defer></script><script src="/assets/js/35.d040bee0.js" defer></script>
</body>
<script type="text/javascript" async
        src="https://s5.cnzz.com/z_stat.php?id=1275911745&web_id=1275911745&show=none"></script>
<script>
(function () {
  var bp = document.createElement('script');
  // var curProtocol = window.location.protocol.split(':')[0];
  // if (curProtocol === 'https') {
  //   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  // }
  // else {
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  // }
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(bp, s);
})();
</script>
</html>
