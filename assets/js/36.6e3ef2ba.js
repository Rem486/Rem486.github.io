(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{287:function(s,e,a){"use strict";a.r(e);var n=a(30),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"npm-管理项目版本号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-管理项目版本号"}},[s._v("#")]),s._v(" npm-管理项目版本号")]),s._v(" "),a("p",[s._v("创建时间：2020-04-20")]),s._v(" "),a("h3",{attrs:{id:"遇到问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#遇到问题"}},[s._v("#")]),s._v(" 遇到问题")]),s._v(" "),a("p",[s._v("在使用 npm 管理项目的时候，"),a("code",[s._v("package.json")]),s._v(" 里面都有一个版本号。需要修改的时候，都是怎么操作的呢？可别再是手动修改了。npm 已经提供了非常方便的命令。")]),s._v(" "),a("h3",{attrs:{id:"解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),a("h2",{attrs:{id:"npm-命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-命令"}},[s._v("#")]),s._v(" npm 命令")]),s._v(" "),a("p",[s._v("命令行输入 "),a("code",[s._v("npm version -h")]),s._v("，可以看到：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version -h\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npm version [<newversion> | major | minor | patch | premajor | preminor | prepatch | prerelease [--preid=<prerelease-id>] | from-git] (run in package dir)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'npm -v' or 'npm --version' to print npm version (6.4.1)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'npm view <pkg> version' to view a package's published version")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'npm ls' to inspect current package/dependency versions")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("后面的参数可以看到，支持直接指定新版本，或者指定升级版本，先行版，测试版等。")]),s._v(" "),a("p",[a("strong",[s._v("举例说明🌰")])]),s._v(" "),a("p",[s._v("假如我们现在的版本号是 "),a("code",[s._v("version: 1.0.0")]),s._v("，下面我们依次运行下面代码")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version major // 主版本号:当你做了不兼容的API修改\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v2.0.0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version minor // 次版本号:当你做了向下兼容的功能性新增\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v2.1.0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version patch // 补丁号:当你做了向下兼容的问题修正\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v2.1.1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version premajor // 预备主版本\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.0.0-0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version preminor // 预备次版本\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.0-0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prepatch // 预备补丁版本\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1-0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prerelease // 预发布版本\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1-1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prerelease --preid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("alpha // 命名先行版,测试版用beta\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1.-alpha.0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version prerelease // 升级先行版\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1-alpha.1")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("p",[s._v("补充说明，运行 "),a("code",[s._v("npm version")]),s._v(" 的时候，本地 "),a("code",[s._v("git status")]),s._v(" 需要是 "),a("code",[s._v("clear")]),s._v(" 的。因为运行命令之后会自动提交一个 "),a("code",[s._v("commit")]),s._v(" 并打上 "),a("code",[s._v("tag")]),s._v("。")]),s._v(" "),a("p",[s._v("也可以自定义 "),a("code",[s._v("commit message")]),s._v("。比如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" version patch -m "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"升级到 %s: 演示自定义msg"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v3.1.1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("code",[s._v("message")]),s._v(" 中的 "),a("code",[s._v("s%")]),s._v(" 将会被替换为版本号。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/23/Ja3oSf.jpg",alt:"npm-version"}})]),s._v(" "),a("h2",{attrs:{id:"版本号策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本号策略"}},[s._v("#")]),s._v(" 版本号策略")]),s._v(" "),a("p",[s._v("我们需要根据改动来选择升级对应版本号。\n版本号格式：主版本号.次版本号.补丁号：")]),s._v(" "),a("ul",[a("li",[s._v("主版本号：当你做了不兼容的 API 修改;")]),s._v(" "),a("li",[s._v("次版本号：当你做了向下兼容的功能性新增;")]),s._v(" "),a("li",[s._v("补丁号：当你做了向下兼容的问题修正;")]),s._v(" "),a("li",[s._v("预发布版本号：还没有正式发布的版本")])]),s._v(" "),a("p",[s._v("版本号只能增加，禁止下降，代码的修改必须以新版形式更新。")]),s._v(" "),a("p",[s._v("特别是当你的代码已经是正式环境，而且有使用者依赖。升级的时候就需要仔细的注意不兼容性问题。")]),s._v(" "),a("h2",{attrs:{id:"真实案例🌰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#真实案例🌰"}},[s._v("#")]),s._v(" 真实案例🌰")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/beautify-web/js-beautify/issues/1783",target:"_blank",rel:"noopener noreferrer"}},[s._v("Node version requires at least 10"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("issue 截图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/23/JaJ9Z4.jpg",alt:"mkdirp-version"}})]),s._v(" "),a("p",[s._v("背景这样的，项目里面依赖了 "),a("code",[s._v("js-beautify@^1.10.3")]),s._v(" 这个仓库，然后它又依赖了 "),a("code",[s._v("mkdirp@~0.5.1")]),s._v(" 。")]),s._v(" "),a("p",[s._v("然后，"),a("code",[s._v("mkdirp")]),s._v(" 的作者在前不久更新了对 "),a("code",[s._v("nodejs")]),s._v(" 版本的依赖，从 "),a("code",[s._v("node@8 -> node@10")]),s._v("。并升级版本到 "),a("code",[s._v("mkdirp@1.0.0")]),s._v(" "),a("a",{attrs:{href:"https://github.com/isaacs/node-mkdirp/commit/2ecfd4901c47692ffa04e495d9248d115b83de55#diff-b9cfc7f2cdf78a7f4b91a753d10865a2",target:"_blank",rel:"noopener noreferrer"}},[s._v("package updates"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("提交记录截图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/23/JaUzVS.jpg",alt:"mkdirp-update"}})]),s._v(" "),a("p",[s._v("然后，"),a("code",[s._v("js-beautify")]),s._v(" 升级到 "),a("code",[s._v("1.11.x")]),s._v(" 的时候，顺便也升级了 "),a("code",[s._v("mkdirp@~1.0.3")]),s._v("。")]),s._v(" "),a("p",[s._v("然后 "),a("code",[s._v("js-beautify")]),s._v(" 这次升级的是次版本号，所以在安装依赖的时候就会安装 "),a("code",[s._v("js-beautify@1.11.x")]),s._v("，进而安装 "),a("code",[s._v("mkdirp@~1.0.3")])]),s._v(" "),a("p",[s._v("最后，对 "),a("code",[s._v("nodejs")]),s._v(" 版本的依赖也就变成了 "),a("code",[s._v("node@10")]),s._v("。就会提示")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('error mkdirp@1.0.4: The engine "node" is incompatible with this module. Expected version ">=10". Got "8.x"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("因为运行环境安装的还是 "),a("code",[s._v("node@8")]),s._v("，可能有同学就说那就升级一下 node 版本就好了。如果是我们本地开发环境，当然很 easy , n/nvm 都可以方便管理 node 版本。但是这个报错是在公司的 CI 服务器上，就很尴尬了。因为上面跑了很多项目，也没法说想升级就升级。")]),s._v(" "),a("p",[s._v("临时办法总还是有的，那就是 "),a("code",[s._v("yarn.lock")]),s._v("/"),a("code",[s._v("package-lock.json")]),s._v(" 里面锁定版本。"),a("code",[s._v("js-beautify to 1.10.3, mkdirp to 0.5.5")]),s._v("。")]),s._v(" "),a("p",[s._v("最后最后，我觉得 isaacs 在升级 node 依赖的时候的推特说的挺有道理的。因为 node@8 停止更新有段时间了，所以升级 node@10 ，后面评论里还补充了一句下次 node@10 停止的时候，又会再次考虑升级。")]),s._v(" "),a("p",[s._v("推文截图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/23/JaLfMj.jpg",alt:"mkdirp-tt"}})]),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("让我想到了 某E ，我们应该支持这种升级。")]),s._v(" "),a("img",{attrs:{src:"https://s1.ax1x.com/2020/04/23/JaODl4.jpg",alt:"mkdirp-ie"}})]),s._v(" "),a("h2",{attrs:{id:"管理-tag"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理-tag"}},[s._v("#")]),s._v(" 管理 tag")]),s._v(" "),a("h3",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://semver.org/lang/zh-CN/",target:"_blank",rel:"noopener noreferrer"}},[s._v("语义化版本 2.0.0"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://docs.npmjs.com/cli/version#description",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm-version"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=t.exports}}]);