(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{362:function(s,t,a){"use strict";a.r(t);var e=a(40),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_2021-06-问题记录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2021-06-问题记录"}},[s._v("#")]),s._v(" 2021-06 问题记录")]),s._v(" "),a("p",[a("strong",[s._v("2021/6/2 周三")])]),s._v(" "),a("h2",{attrs:{id:"nuxt-添加-eslint-和-prettier"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nuxt-添加-eslint-和-prettier"}},[s._v("#")]),s._v(" nuxt 添加 eslint 和 prettier")]),s._v(" "),a("p",[a("RouterLink",{attrs:{to:"/web/tool/eslint-prettier-nuxt.html"}},[s._v("nuxt 添加 eslint 和 prettier")])],1),s._v(" "),a("hr"),s._v(" "),a("p",[a("strong",[s._v("2021/6/3 周四")])]),s._v(" "),a("h2",{attrs:{id:"eslint-prettier-基于-husky-来格式化代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eslint-prettier-基于-husky-来格式化代码"}},[s._v("#")]),s._v(" ESLint + Prettier 基于 husky 来格式化代码")]),s._v(" "),a("h3",{attrs:{id:"_1-安装依赖-husky"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装依赖-husky"}},[s._v("#")]),s._v(" 1.安装依赖 husky")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("npx husky-init "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# npm")]),s._v("\nnpx husky-init "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Yarn 1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" dlx husky-init --yarn2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Yarn 2")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i lint-staged -D "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对 git 提交的代码使用 linter")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("code",[s._v("husky-init")]),s._v(" 是一个一次性命令，可以快速初始化项目的 husky 配置。会修改 "),a("code",[s._v("package.json")]),s._v("，增加一个 "),a("code",[s._v("scrpits")]),s._v("："),a("code",[s._v('"prepare": "husky install"')]),s._v(" ，并且创建一个 "),a("code",[s._v("pre-commit")]),s._v(" 的示例（提交 commit 的时候执行 "),a("code",[s._v("npm test")]),s._v("）。每次 "),a("code",[s._v("npm install")]),s._v(" 之后都会执行 "),a("code",[s._v("prepare")]),s._v(" 来激活 git hook。\n"),a("a",{attrs:{href:"https://typicode.github.io/husky/#/",target:"_blank",rel:"noopener noreferrer"}},[s._v("husky"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("code",[s._v("lint-staged")]),s._v(" 可以减少每次 lint 的操作范围，减少操作，把影响降低。因为我们有可能是项目途中才引入的 prettier，对一些早已经编写完成的代码进行格式化，可能会造成冲突或者一些不可预知的问题，降低项目稳定性。因此仅对本次提交的代码进行格式化，确保不会影响到其它未测试的代码。")]),s._v(" "),a("h3",{attrs:{id:"_2-修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改配置"}},[s._v("#")]),s._v(" 2.修改配置")]),s._v(" "),a("ul",[a("li",[s._v("编辑 "),a("code",[s._v("pacakge.json")]),s._v("，添加 scripts "),a("code",[s._v('"pre-commit-lint": "lint-staged"')])]),s._v(" "),a("li",[s._v("编辑 "),a("code",[s._v(".husky/pre-commit")]),s._v("，添加 "),a("code",[s._v("npm run pre-commit-lint")])]),s._v(" "),a("li",[s._v("添加 "),a("code",[s._v("lint-staged")]),s._v(" 配置")])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// .lintstagedrc.js")]),s._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*.{js,jsx,ts,tsx}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prettier --write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'eslint --fix'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{!(package)*.json,*.code-snippets}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prettier --write--parser json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'package.json'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prettier --write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*.vue'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prettier --write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'eslint --fix'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*.{scss,less,styl,css,html}'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prettier --write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*.md'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prettier --write'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://github.com/typicode/husky/issues/949",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_3-eslint-和-prettier-区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-eslint-和-prettier-区别"}},[s._v("#")]),s._v(" 3.eslint 和 prettier 区别")]),s._v(" "),a("ul",[a("li",[s._v("eslint（包括其他一些 lint 工具）的主要功能包含代码格式的校验，代码质量的校验。")]),s._v(" "),a("li",[s._v("prettier 只是代码格式的校验（并格式化代码），不会对代码质量进行校验。")])]),s._v(" "),a("p",[s._v("代码格式问题通常指的是：单行代码长度、tab长度、空格、逗号表达式等问题。而代码质量问题指的是：未使用变量、三等号、全局变量声明等问题")]),s._v(" "),a("h3",{attrs:{id:"_4-eslint-和-prettier-配合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-eslint-和-prettier-配合"}},[s._v("#")]),s._v(" 4.eslint 和 prettier 配合")]),s._v(" "),a("p",[s._v("一般还是先使用 prettier 格式化再使用 eslint 校验。避免格式化后提交的代码在下一次或者别人 checkout 代码后通不过 eslint 校验的情况，以及一些可能存在的格式问题。\n"),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/68026905",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"_5-ci-环境的时候跳过"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-ci-环境的时候跳过"}},[s._v("#")]),s._v(" 5.CI 环境的时候跳过")]),s._v(" "),a("ul",[a("li",[s._v("在 CI 设置一个环境变量，然后跳过执行")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .husky/pre-commit")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$CI")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[s._v("使用第三方包 "),a("code",[s._v("is-ci")]),s._v("：")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" is-ci --save-dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改 "),a("code",[s._v("package.json")])]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"prepare"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"is-ci || husky install"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"babel-jest-不支持-babel7-的解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#babel-jest-不支持-babel7-的解决方案"}},[s._v("#")]),s._v(" babel-jest 不支持 babel7 的解决方案")]),s._v(" "),a("p",[s._v("jest 本身不支持 es6 语法，需要使用 babel-jest 插件进行转换。")]),s._v(" "),a("p",[s._v("babel-jest 需要依赖 "),a("code",[s._v("babel-core")]),s._v("。 babel7 好像不支持(babel-jest@24.1.0)。可以使用 "),a("code",[s._v("babel-core@^7.0.0-bridge.0")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" i babel-core@^7.0.0-bridge.0 -D\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("可以认为 babel-core@^7.0.0-bridge.0 插件是将 babel6 衔接到 babel7 的一个桥梁")])])])}),[],!1,null,null,null);t.default=n.exports}}]);