(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{395:function(s,a,n){"use strict";n.r(a);var e=n(40),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"mongodb-权限管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-权限管理"}},[s._v("#")]),s._v(" mongodb - 权限管理")]),s._v(" "),n("h4",{attrs:{id:"遇到问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#遇到问题"}},[s._v("#")]),s._v(" 遇到问题")]),s._v(" "),n("p",[s._v("需要增加用户权限来控制数据的连接，免得数据库裸奔。")]),s._v(" "),n("ol",[n("li",[s._v("创建管理员用户，设置权限")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 进入 mongodb 的 shell\nmongo\n\n# 切换数据，到 admin\nshow dbs\nuse admin\n\n# 创建 admin 超级管理员用户\ndb.createUser(  \n  { user: "root",  \n    customData：{description:"superuser"},\n    pwd: "123456",  \n    roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]  \n  }  \n) \n\n# 如果已经创建了，可以先获取权限\ndb.auth(\'root\',\'123456\')\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("blockquote",[n("p",[s._v("user字段，为新用户的名字；"),n("br"),s._v("\npwd字段，用户的密码；"),n("br"),s._v("\ncustomData字段，为任意内容，例如可以为用户全名介绍；"),n("br"),s._v("\nroles字段，指定用户的角色，可以用一个空数组给新用户设定空角色。在roles字段,可以指定内置角色和用户定义的角色。超级用户的role有两种，userAdmin或者userAdminAnyDatabase(比前一种多加了对所有数据库的访问,仅仅是访问而已)。"),n("br"),s._v("\ndb是指定数据库的名字，admin是管理数据库。不能用admin数据库中的用户登录其他数据库。注：只能查看当前数据库中的用户，哪怕当前数据库admin数据库，也只能查看admin数据库中创建的用户。")])]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("创建业务数据库管理员用户")])]),s._v(" "),n("blockquote",[n("p",[s._v("只负责某一个或几个数据库的增删改查")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('> db.createUser({\n    user:"user001",\n    pwd:"123456",\n    roles:[\n        {role:"readWrite",db:"db001"},\n        {role:"readWrite",db:"db002"},\n        \'read\'// 对其他数据库有只读权限，对db001、db002是读写权限\n    ]\n})\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("MongoDB 数据库角色：")]),s._v(" "),n("ul",[n("li",[s._v("数据库用户角色：read、readWrite;")]),s._v(" "),n("li",[s._v("数据库管理角色：dbAdmin、dbOwner、userAdmin；")]),s._v(" "),n("li",[s._v("集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；")]),s._v(" "),n("li",[s._v("备份恢复角色：backup、restore；")]),s._v(" "),n("li",[s._v("所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase")]),s._v(" "),n("li",[s._v("超级用户角色：root // 这里还有几个角色间接或直接提供了系统超级用户的访问（dbOwner 、userAdmin、userAdminAnyDatabase）")]),s._v(" "),n("li",[s._v("内部角色：__system")])]),s._v(" "),n("p",[s._v("角色说明：")]),s._v(" "),n("ul",[n("li",[s._v("Read：允许用户读取指定数据库")]),s._v(" "),n("li",[s._v("readWrite：允许用户读写指定数据库")]),s._v(" "),n("li",[s._v("dbAdmin：允许用户在指定数据库中执行管理函数，如索引创建、删除，查看统计或访问system.profile")]),s._v(" "),n("li",[s._v("userAdmin：允许用户向system.users集合写入，可以找指定数据库里创建、删除和管理用户")]),s._v(" "),n("li",[s._v("clusterAdmin：只在admin数据库中可用，赋予用户所有分片和复制集相关函数的管理权限。")]),s._v(" "),n("li",[s._v("readAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读权限")]),s._v(" "),n("li",[s._v("readWriteAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的读写权限")]),s._v(" "),n("li",[s._v("userAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的userAdmin权限")]),s._v(" "),n("li",[s._v("dbAdminAnyDatabase：只在admin数据库中可用，赋予用户所有数据库的dbAdmin权限。")]),s._v(" "),n("li",[s._v("root：只在admin数据库中可用。超级账号，超级权限")])]),s._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[s._v("查看创建的用户")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('show users \n或 db.system.users.find() \n或 db.runCommand({usersInfo:"userName"})\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[s._v("修改密码")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('use admin\ndb.changeUserPassword("username", "xxx")\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",{attrs:{start:"5"}},[n("li",[s._v("修改用户信息")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('db.runCommand(\n    {\n        updateUser:"username",\n        pwd:"xxx",\n        customData:{title:"xxx"}\n    }\n)\n\ndb.updateUser("username",\n    {pwd:"xxx",roles:[{role:"read",db:"test"}]}\n)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ol",{attrs:{start:"6"}},[n("li",[s._v("追加用户权限")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('db.grantRolesToUser("username",\n    [{role:"readWrite",db:"test"}]\n)\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ol",{attrs:{start:"7"}},[n("li",[s._v("删除用户")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('db.dropUser("username")\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ol",{attrs:{start:"8"}},[n("li",[s._v("启用 mongodb 权限验证：")])]),s._v(" "),n("ul",[n("li",[s._v("命令行启动的时候 "),n("code",[s._v("mongo --auth")])]),s._v(" "),n("li",[s._v("使用 mongo.conf :")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("# 启用权限访问\n  auth=true\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",{attrs:{start:"9"}},[n("li",[s._v("重启 mongodb")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("连接配置")]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"uri"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongodb://user486:123456@localhost:27017/movie?authSource=movie"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"options"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"useNewUrlParser"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"useUnifiedTopology"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("h4",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/u013066244/article/details/53874216",target:"_blank",rel:"noopener noreferrer"}},[s._v("mongodb用户权限管理配置"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.luoruiyuan.cn/pages/id-84_uid-2_btid-20.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("MongoDB 用户添加，修改，删除，权限追加"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=t.exports}}]);